<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>A Simple Technique to Get Segmentation Masks for Choroid Vessels - Atharva&#x27;s Blog</title><meta name="description" content="The choroid is an important part of the eye and is clearly visible in OCT B-scan images. Segmenting the entire choroid region is already a well-solved problem SOTA benchmarks are more or less saturated. But the real challenge now is to go one level deeper:&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://Atharva-Attarde.github.io/a-simple-technique-to-get-segmentation-masks-for-choroid-vessels-2.html"><link rel="alternate" type="application/atom+xml" href="https://Atharva-Attarde.github.io/feed.xml" title="Atharva&#x27;s Blog - RSS"><link rel="alternate" type="application/json" href="https://Atharva-Attarde.github.io/feed.json" title="Atharva&#x27;s Blog - JSON"><meta property="og:title" content="A Simple Technique to Get Segmentation Masks for Choroid Vessels"><meta property="og:image" content="https://Atharva-Attarde.github.io/media/posts/6/0045.png"><meta property="og:image:width" content="512"><meta property="og:image:height" content="512"><meta property="og:site_name" content="Atharva's Blog"><meta property="og:description" content="The choroid is an important part of the eye and is clearly visible in OCT B-scan images. Segmenting the entire choroid region is already a well-solved problem SOTA benchmarks are more or less saturated. But the real challenge now is to go one level deeper:&hellip;"><meta property="og:url" content="https://Atharva-Attarde.github.io/a-simple-technique-to-get-segmentation-masks-for-choroid-vessels-2.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@AtharvaAttarde"><meta name="twitter:title" content="A Simple Technique to Get Segmentation Masks for Choroid Vessels"><meta name="twitter:description" content="The choroid is an important part of the eye and is clearly visible in OCT B-scan images. Segmenting the entire choroid region is already a well-solved problem SOTA benchmarks are more or less saturated. But the real challenge now is to go one level deeper:&hellip;"><meta name="twitter:image" content="https://Atharva-Attarde.github.io/media/posts/6/0045.png"><link rel="stylesheet" href="https://Atharva-Attarde.github.io/assets/css/style.css?v=fafdaaaf21e0ae9678e49280e0b8d62b"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://Atharva-Attarde.github.io/a-simple-technique-to-get-segmentation-masks-for-choroid-vessels-2.html"},"headline":"A Simple Technique to Get Segmentation Masks for Choroid Vessels","datePublished":"2025-07-16T21:12+05:30","dateModified":"2025-07-16T21:20+05:30","image":{"@type":"ImageObject","url":"https://Atharva-Attarde.github.io/media/posts/6/0045.png","height":512,"width":512},"description":"The choroid is an important part of the eye and is clearly visible in OCT B-scan images. Segmenting the entire choroid region is already a well-solved problem SOTA benchmarks are more or less saturated. But the real challenge now is to go one level deeper:&hellip;","author":{"@type":"Person","name":"Atharva Attarde","url":"https://Atharva-Attarde.github.io/authors/atharva-attarde/"},"publisher":{"@type":"Organization","name":"Atharva Attarde"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><header class="top js-header"><a class="logo" href="https://Atharva-Attarde.github.io/">Atharva&#x27;s Blog</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://Atharva-Attarde.github.io/" target="_self">Home</a></li><li><a href="https://Atharva-Attarde.github.io/medical-image-analysis-2.html" target="_self">Medical Image Analysis</a></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><div class="wrapper search__overlay-inner"></div></div><button class="search__btn btn--icon js-search-btn" aria-label="Search"><svg height="18" width="18" role="presentation" focusable="false"><use xlink:href="https://Atharva-Attarde.github.io/assets/svg/svg-map.svg#search"/></svg></button></div></header><main class="post"><article class="content"><div class="hero"><header class="hero__content hero__content--centered"><div class="wrapper"><h1>A Simple Technique to Get Segmentation Masks for Choroid Vessels</h1><div class="feed__meta content__meta content__meta--centered"><a href="https://Atharva-Attarde.github.io/authors/atharva-attarde/" class="feed__author">Atharva Attarde</a> <time datetime="2025-07-16T21:12" class="feed__date">July 16, 2025</time></div></div></header><figure class="hero__image"><div class="hero__image-wrapper"><img src="https://Atharva-Attarde.github.io/media/posts/6/0045.png" srcset="https://Atharva-Attarde.github.io/media/posts/6/responsive/0045-xs.png 640w, https://Atharva-Attarde.github.io/media/posts/6/responsive/0045-sm.png 768w, https://Atharva-Attarde.github.io/media/posts/6/responsive/0045-md.png 1024w, https://Atharva-Attarde.github.io/media/posts/6/responsive/0045-lg.png 1366w, https://Atharva-Attarde.github.io/media/posts/6/responsive/0045-xl.png 1600w, https://Atharva-Attarde.github.io/media/posts/6/responsive/0045-2xl.png 1920w" sizes="88vw" loading="eager" height="512" width="512" alt=""></div></figure></div><div class="entry-wrapper content__entry"><p data-start="245" data-end="447">The choroid is an important part of the eye and is clearly visible in OCT B-scan images. Segmenting the entire choroid region is already a well-solved problem SOTA benchmarks are more or less saturated.</p><p data-start="449" data-end="735">But the real challenge now is to go one level deeper: segmenting specific structures <em data-start="534" data-end="542">within</em> the choroid. In particular, the choroidal vasculature is a crucial biomarker, and being able to extract the vessel structure from the choroid region could have important clinical implications.</p><p data-start="737" data-end="1132">The latest paper I came across on this topic is by <a href="https://rdcu.be/ewuxC" target="_blank" rel="noopener noreferrer">Valsecchi, N</a> , where they’ve used Phansalkar thresholding to extract the vessels. But I noticed that this doesn’t work well for all images. In some cases like the one below you can clearly see the vessels, but due to speckle noise, there are a lot of false bright spots scattered in the dark vessel regions. These are misleading and break the mask quality.</p><figure><figure class="post__image post__image--center"><img loading="lazy" src="https://Atharva-Attarde.github.io/media/posts/6/Original-Image-2.png" alt="Original B scan" width="392" height="407" sizes="(max-width: 1920px) 100vw, 1920px" srcset="https://Atharva-Attarde.github.io/media/posts/6/responsive/Original-Image-2-xs.png 640w, https://Atharva-Attarde.github.io/media/posts/6/responsive/Original-Image-2-sm.png 768w, https://Atharva-Attarde.github.io/media/posts/6/responsive/Original-Image-2-md.png 1024w, https://Atharva-Attarde.github.io/media/posts/6/responsive/Original-Image-2-lg.png 1366w, https://Atharva-Attarde.github.io/media/posts/6/responsive/Original-Image-2-xl.png 1600w, https://Atharva-Attarde.github.io/media/posts/6/responsive/Original-Image-2-2xl.png 1920w"></figure><figcaption>Original B Scan</figcaption></figure><p data-start="737" data-end="1132"> </p><p data-start="1134" data-end="1425">Another issue is that <strong data-start="1156" data-end="1212">hand-annotating these vessels is extremely expensive</strong>. The vessels are thin, irregular, and scattered across noisy regions, which makes consistent manual labeling both time-consuming and error-prone. So the need for automatic or semi-automatic methods is quite real.</p><p data-start="1427" data-end="1592">To tackle the noise problem, I tried several methods NLM, BM3D, Noise2Void, etc. and finally settled on a really simple pipeline that gave surprisingly good results.</p><h3 data-start="1599" data-end="1616">The Technique</h3><p data-start="1618" data-end="1762">We start with a predicted choroid mask from a SOTA model or hand annotated region (you can use <strong><a href="https://github.com/justinengelmann/Choroidalyzer" target="_blank" rel="noopener noreferrer">Choroidalyzer </a></strong>)and extract only that region from the OCT image.</p><figure><figure class="post__image post__image--center"><img loading="lazy" src="https://Atharva-Attarde.github.io/media/posts/6/extracted_0045.png" alt="Extracted choroid region" width="512" height="512" sizes="(max-width: 1920px) 100vw, 1920px" srcset="https://Atharva-Attarde.github.io/media/posts/6/responsive/extracted_0045-xs.png 640w, https://Atharva-Attarde.github.io/media/posts/6/responsive/extracted_0045-sm.png 768w, https://Atharva-Attarde.github.io/media/posts/6/responsive/extracted_0045-md.png 1024w, https://Atharva-Attarde.github.io/media/posts/6/responsive/extracted_0045-lg.png 1366w, https://Atharva-Attarde.github.io/media/posts/6/responsive/extracted_0045-xl.png 1600w, https://Atharva-Attarde.github.io/media/posts/6/responsive/extracted_0045-2xl.png 1920w"></figure><figcaption>Extracted choroid region</figcaption></figure><p data-start="1618" data-end="1762"> </p><p data-start="1618" data-end="1762">Then, we apply iterative refinement:</p><ol data-start="1764" data-end="2000"><li data-start="1764" data-end="1800"><p data-start="1767" data-end="1800"><strong data-start="1767" data-end="1798">Apply Non-Local Means (NLM)</strong></p></li><li data-start="1801" data-end="1872"><p data-start="1804" data-end="1872"><strong data-start="1804" data-end="1870">Apply CLAHE (Contrast Limited Adaptive Histogram Equalization)</strong></p></li><li data-start="1873" data-end="2000"><p data-start="1876" data-end="2000"><strong data-start="1876" data-end="1903">Apply Otsu Thresholding</strong>  we exclude the black background pixels so they don’t skew the threshold.</p></li></ol><p data-start="2002" data-end="2086">This whole sequence can be repeated for a few iterations to refine the mask further.</p><p data-start="2088" data-end="2126">Here’s the code:</p><div><div><code>import cv2</code></div><div><code>import matplotlib.pyplot as plt</code></div><br><div><code>image = cv2.imread(r"C:\Users\Atharva\Desktop\Archive\OCT\OIHMS DATASET SEPERATED\extracted_masked_regions\extracted_0045.png", cv2.IMREAD_GRAYSCALE)</code></div><div><code># Start with the original image</code></div><div><code>img = image.copy()</code></div><br><div><code># Number of iterations</code></div><div><code>num_iterations = 5</code></div><br><div><code># Store results for visualization</code></div><div><code>results = [img]</code></div><div><code>otsu_results = [cv2.threshold(img, 0, 255, cv2.THRESH_BINARY + cv2.THRESH_OTSU)[1]]</code></div><br><div><code>for i in range(num_iterations):</code></div><div><code>    # Denoising</code></div><div><code>    img = cv2.fastNlMeansDenoising(img, h=10, templateWindowSize=7, searchWindowSize=14)</code></div><div><code>    # CLAHE</code></div><div><code>    clahe = cv2.createCLAHE(clipLimit=2.0, tileGridSize=(8,8))</code></div><div><code>    img = clahe.apply(img)</code></div><div><code>    results.append(img)</code></div><div><code>    # Otsu thresholding</code></div><div><code>    # Create a mask that ignores black pixels (intensity 0)</code></div><div><code>    non_black_mask = img &gt; 0</code></div><br><div><code>    # Compute Otsu threshold only on non-zero pixels</code></div><div><code>    masked_pixels = img[non_black_mask]</code></div><div><code>    if masked_pixels.size &gt; 0:</code></div><div><code>        otsu_thresh = cv2.threshold(masked_pixels, 0, 255, cv2.THRESH_BINARY + cv2.THRESH_OTSU)[0]</code></div><div><code>    else:</code></div><div><code>        otsu_thresh = 0  # fallback if image is all black</code></div><br><div><code>    # Apply threshold to full image using that threshold</code></div><div><code>    _, otsu_img = cv2.threshold(img, otsu_thresh, 255, cv2.THRESH_BINARY)</code></div><br><div><code>    otsu_results.append(otsu_img)</code></div><br><div><code># Plot all iterations and their Otsu results</code></div><div><code>plt.figure(figsize=(15, 8))</code></div><div><code>for idx, (res, otsu_img) in enumerate(zip(results, otsu_results)):</code></div><div><code>    plt.subplot(2, num_iterations + 1, idx + 1)</code></div><div><code>    plt.imshow(res, cmap='gray')</code></div><div><code>    if idx == 0:</code></div><div><code>        plt.title('Original')</code></div><div><code>    else:</code></div><div><code>        plt.title(f'Iter {idx}')</code></div><div><code>    plt.axis('off')</code></div><div><code>    plt.subplot(2, num_iterations + 1, idx + 1 + num_iterations + 1)</code></div><div><code>    plt.imshow(otsu_img, cmap='gray')</code></div><div><code>    plt.axis('off')</code></div><div><code>    if idx == 0:</code></div><div><code>        plt.title('Otsu')</code></div><div><code>    else:</code></div><div><code>        plt.title(f'Otsu {idx}')</code></div><div><code>plt.tight_layout()</code></div><div><code>plt.show()</code></div></div><h3 data-start="2133" data-end="2144">Results</h3><figure><figure class="post__image post__image--wide"><img loading="lazy" src="https://Atharva-Attarde.github.io/media/posts/6/Final-Out.png" alt="" width="1489" height="621" sizes="(max-width: 1920px) 100vw, 1920px" srcset="https://Atharva-Attarde.github.io/media/posts/6/responsive/Final-Out-xs.png 640w, https://Atharva-Attarde.github.io/media/posts/6/responsive/Final-Out-sm.png 768w, https://Atharva-Attarde.github.io/media/posts/6/responsive/Final-Out-md.png 1024w, https://Atharva-Attarde.github.io/media/posts/6/responsive/Final-Out-lg.png 1366w, https://Atharva-Attarde.github.io/media/posts/6/responsive/Final-Out-xl.png 1600w, https://Atharva-Attarde.github.io/media/posts/6/responsive/Final-Out-2xl.png 1920w"></figure><figcaption>Pipeline Results</figcaption></figure><p data-start="2146" data-end="2192"> </p><h3 data-start="2199" data-end="2223">Notes and Discussion</h3><p data-start="2225" data-end="2478">One thing to keep in mind: the number of iterations matters. Over-iterating will start to introduce artifacts and may exaggerate vessel regions. </p><p data-start="2485" data-end="2654"> </p><p data-start="2485" data-end="2654"><strong data-start="2488" data-end="2507">Follow the blog</strong> - in the next post, we’ll explore <strong data-start="2542" data-end="2578">PU (Positive-Unlabeled) labeling</strong> to segment choroidal vessels even when annotations are incomplete or noisy.</p><p data-start="2656" data-end="2950">In real datasets, <strong data-start="2674" data-end="2708">annotations are rarely perfect </strong>some vessels are missed, others are loosely outlined. With PU learning, we’ll try to train models that treat the labeled vessels as <em data-start="2841" data-end="2852">positives</em> and the rest as <em data-start="2869" data-end="2880">unlabeled </em>helping the model learn the full structure even from imperfect masks.</p></div><footer class="content__footer"><div class="entry-wrapper"><p class="content__updated">This article was updated on July 16, 2025</p><div class="content__actions"><ul class="content__tag"><li><a href="https://Atharva-Attarde.github.io/tags/oct-choroid/">OCT, Choroid</a></li></ul><div class="content__share"><button class="btn--icon content__share-button js-content__share-button"><svg width="20" height="20" aria-hidden="true"><use xlink:href="https://Atharva-Attarde.github.io/assets/svg/svg-map.svg#share"></use></svg> <span>Share It</span></button><div class="content__share-popup js-content__share-popup"><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2FAtharva-Attarde.github.io%2Fa-simple-technique-to-get-segmentation-masks-for-choroid-vessels-2.html&amp;via=%40AtharvaAttarde&amp;text=A%20Simple%20Technique%20to%20Get%20Segmentation%20Masks%20for%20Choroid%20Vessels" class="js-share twitter" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://Atharva-Attarde.github.io/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2FAtharva-Attarde.github.io%2Fa-simple-technique-to-get-segmentation-masks-for-choroid-vessels-2.html" class="js-share linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://Atharva-Attarde.github.io/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span> </a><a href="https://api.whatsapp.com/send?text=A%20Simple%20Technique%20to%20Get%20Segmentation%20Masks%20for%20Choroid%20Vessels https%3A%2F%2FAtharva-Attarde.github.io%2Fa-simple-technique-to-get-segmentation-masks-for-choroid-vessels-2.html" class="js-share whatsapp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://Atharva-Attarde.github.io/assets/svg/svg-map.svg#whatsapp"/></svg> <span>WhatsApp</span></a></div></div></div><div class="content__bio bio"><div><h3 class="h4 bio__name"><a href="https://Atharva-Attarde.github.io/authors/atharva-attarde/" rel="author">Atharva Attarde</a></h3><div class="bio__desc"><p>I write about AI, medicine, code, and curiosity. This blog is where I share honest thoughts and experiments as I learn and build.</p></div></div></div></div></footer></article><div class="content__comments"><div class="entry-wrapper"></div></div></main><footer class="footer footer--glued"><div class="wrapper"><nav class="footer__nav"><ul><li><a href="https://Atharva-Attarde.github.io/" class="al" target="_self">Home</a></li><li><a href="https://Atharva-Attarde.github.io/medical-image-analysis-2.html" class="al" target="_self">Medical Image Analysis</a></li></ul></nav><div class="footer__copyright"><p>© 2025 Atharva Attarde. All rights reserved.</p></div><div class="footer__social"><a href="https://x.com/AtharvaAttarde" aria-label="X"><svg><use xlink:href="https://Atharva-Attarde.github.io/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="www.linkedin.com/in/atharva-attarde-769728219" aria-label="LinkedIn"><svg><use xlink:href="https://Atharva-Attarde.github.io/assets/svg/svg-map.svg#linkedin"/></svg></a></div><button id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg width="20" height="20"><use xlink:href="https://Atharva-Attarde.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></div></footer><script defer="defer" src="https://Atharva-Attarde.github.io/assets/js/scripts.min.js?v=700105c316933a8202041b6415abb233"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>